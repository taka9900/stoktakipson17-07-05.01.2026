<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hƒ±rdavat Stok Y√∂netimi</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }
        button, input, select { -webkit-tap-highlight-color: transparent; }
        @media (max-width: 768px) { .modal-content { max-height: 85vh !important; } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        emailjs.init("z4XlpyIt1cd9My5J5");

        const firebaseConfig = {
            apiKey: "AIzaSyATqEqYWYEL-EZy4v8E3fw-fYNIDmWpjvc",
            authDomain: "stoktakip-c4c51.firebaseapp.com",
            databaseURL: "https://stoktakip-c4c51-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "stoktakip-c4c51",
            storageBucket: "stoktakip-c4c51.firebasestorage.app",
            messagingSenderId: "341724317170",
            appId: "1:341724317170:web:746ea3fefa38e190dc976b",
            measurementId: "G-GCSHPXVCPK"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        function StokApp() {
            const [currentUser, setCurrentUser] = useState(null);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [products, setProducts] = useState([]);
            const [cart, setCart] = useState([]);
            const [campaigns, setCampaigns] = useState({});
            const [offers, setOffers] = useState([]);
            const [showOffers, setShowOffers] = useState(false);
            const [currentOffer, setCurrentOffer] = useState(null);
            const [orders, setOrders] = useState([]);
            const [showOrders, setShowOrders] = useState(false);
            const [offerForm, setOfferForm] = useState({ customerName: '', customerContact: '', notes: '' });
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('T√ºm√º');
            const [showCart, setShowCart] = useState(false);
            const [currentPage, setCurrentPage] = useState(1);
            const [itemsPerPage] = useState(10);
            const [selectedProducts, setSelectedProducts] = useState([]);
            const [settings, setSettings] = useState({
                globalDiscount: 0,
                categoryDiscounts: {},
                profitRates: { pesin: 20, vade30: 25, vade60: 30, vade90: 35 }
            });
            const [isLoading, setIsLoading] = useState(true);
            const [loadingError, setLoadingError] = useState(null);
            const [modals, setModals] = useState({
                discount: false, categoryDiscount: false, profit: false, exchange: false,
                addProduct: false, editProduct: false, campaign: false, addToCart: false,
                createOffer: false, editOffer: false
            });
            const [tempData, setTempData] = useState({});
            const [productForm, setProductForm] = useState({
                name: '', category: '', unit: 'Adet', priceTL: 0, priceUSD: 0, priceEUR: 0, currentStock: 0, minStock: 10
            });
            const [cartForm, setCartForm] = useState({
                productId: null, productName: '', price: 0, quantity: 1, paymentType: 'pesin', manuelPrice: ''
            });
            
            // QR Kod State'leri
            const [qrModal, setQrModal] = useState({ show: false, product: null });
            const [customerView, setCustomerView] = useState({ show: false, product: null, salePrice: 0 });
            const [labelCount, setLabelCount] = useState(21);

            const USERS = {
                admin: { password: '159036', role: 'admin', name: 'Y√∂netici' },
                satis1: { password: '1234', role: 'user', name: 'Satƒ±≈ü 1' },
                satis2: { password: '1234', role: 'user', name: 'Satƒ±≈ü 2' },
                depo1: { password: '1234', role: 'user', name: 'Depo 1' },
                muhasebe: { password: '1234', role: 'user', name: 'Muhasebe' },
                magaza: { password: '1234', role: 'user', name: 'Maƒüaza' }
            };

            // T√ºrk√ße karakter d√∂n√º≈üt√ºrme
            const toAscii = (text) => {
                if (!text) return '';
                return text
                    .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                    .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                    .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                    .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                    .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                    .replace(/√ß/g, 'c').replace(/√á/g, 'C');
            };

            // QR Kod URL'i olu≈ütur
            const generateQRUrl = (product) => {
                const baseUrl = window.location.origin + window.location.pathname;
                const params = new URLSearchParams({
                    pid: product.id,
                    pn: product.name,
                    pp: product.priceTL,
                    pc: product.category || 'Genel'
                });
                return `${baseUrl}?qr=${btoa(unescape(encodeURIComponent(params.toString())))}`;
            };

            // QR Kod modalƒ±nƒ± a√ß/kapat
            const openQRModal = (product) => setQrModal({ show: true, product });
            const closeQRModal = () => setQrModal({ show: false, product: null });

            // Tek Etiket Yazdƒ±r
            const printLabel = (product) => {
                const { jsPDF } = window.jspdf;
                const salePrice = product.priceTL * 1.5;
                
                const doc = new jsPDF({ orientation: 'landscape', unit: 'mm', format: [60, 40] });
                
                const qrContainer = document.createElement('div');
                qrContainer.style.position = 'absolute';
                qrContainer.style.left = '-9999px';
                document.body.appendChild(qrContainer);
                
                new QRCode(qrContainer, {
                    text: generateQRUrl(product),
                    width: 200, height: 200,
                    colorDark: '#000000', colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.M
                });
                
                setTimeout(() => {
                    const canvas = qrContainer.querySelector('canvas');
                    if (canvas) {
                        const qrDataUrl = canvas.toDataURL('image/png');
                        
                        doc.addImage(qrDataUrl, 'PNG', 2, 2, 28, 28);
                        
                        doc.setFontSize(8);
                        doc.setFont('helvetica', 'bold');
                        const name = toAscii(product.name);
                        const displayName = name.length > 18 ? name.substring(0, 18) + '...' : name;
                        doc.text(displayName, 32, 8);
                        
                        doc.setFontSize(6);
                        doc.setFont('helvetica', 'normal');
                        doc.text(toAscii(product.category || 'Genel'), 32, 13);
                        
                        doc.setFontSize(14);
                        doc.setFont('helvetica', 'bold');
                        doc.text(salePrice.toFixed(2) + ' TL', 32, 22);
                        
                        doc.setFontSize(5);
                        doc.setFont('helvetica', 'normal');
                        doc.text('KDV Dahil', 32, 27);
                        doc.text('Kod: ' + product.id, 32, 31);
                        
                        doc.save(`etiket_${toAscii(product.name).replace(/\s+/g, '_')}.pdf`);
                    }
                    document.body.removeChild(qrContainer);
                }, 200);
            };

            // √áoklu Etiket Yazdƒ±r (A4)
            const printMultipleLabels = (product, count) => {
                const { jsPDF } = window.jspdf;
                const salePrice = product.priceTL * 1.5;
                
                const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                
                // 3 s√ºtun x 7 satƒ±r = 21 etiket (veya 5x13 = 65)
                const cols = count > 30 ? 5 : 3;
                const rows = count > 30 ? 13 : 7;
                const labelWidth = count > 30 ? 38 : 63;
                const labelHeight = count > 30 ? 21 : 38;
                const marginX = count > 30 ? 5 : 7;
                const marginY = count > 30 ? 5 : 7;
                
                const qrContainer = document.createElement('div');
                qrContainer.style.position = 'absolute';
                qrContainer.style.left = '-9999px';
                document.body.appendChild(qrContainer);
                
                new QRCode(qrContainer, {
                    text: generateQRUrl(product),
                    width: 200, height: 200,
                    colorDark: '#000000', colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.M
                });
                
                setTimeout(() => {
                    const canvas = qrContainer.querySelector('canvas');
                    if (canvas) {
                        const qrDataUrl = canvas.toDataURL('image/png');
                        let labelNum = 0;
                        
                        for (let row = 0; row < rows && labelNum < count; row++) {
                            for (let col = 0; col < cols && labelNum < count; col++) {
                                const x = marginX + (col * labelWidth);
                                const y = marginY + (row * labelHeight);
                                
                                doc.setDrawColor(220);
                                doc.setLineWidth(0.1);
                                doc.rect(x, y, labelWidth, labelHeight);
                                
                                const qrSize = count > 30 ? 16 : 26;
                                doc.addImage(qrDataUrl, 'PNG', x + 1, y + 1, qrSize, qrSize);
                                
                                const textX = x + qrSize + 2;
                                
                                doc.setFontSize(count > 30 ? 6 : 8);
                                doc.setFont('helvetica', 'bold');
                                const name = toAscii(product.name);
                                const maxLen = count > 30 ? 12 : 18;
                                const displayName = name.length > maxLen ? name.substring(0, maxLen) + '..' : name;
                                doc.text(displayName, textX, y + 5);
                                
                                doc.setFontSize(count > 30 ? 5 : 6);
                                doc.setFont('helvetica', 'normal');
                                doc.text(toAscii(product.category || 'Genel'), textX, y + (count > 30 ? 9 : 10));
                                
                                doc.setFontSize(count > 30 ? 10 : 12);
                                doc.setFont('helvetica', 'bold');
                                doc.text(salePrice.toFixed(2) + ' TL', textX, y + (count > 30 ? 15 : 18));
                                
                                doc.setFontSize(count > 30 ? 4 : 5);
                                doc.setFont('helvetica', 'normal');
                                doc.text('KDV Dahil', textX, y + (count > 30 ? 18 : 23));
                                
                                labelNum++;
                            }
                        }
                        
                        doc.save(`etiketler_${toAscii(product.name).replace(/\s+/g, '_')}_${count}adet.pdf`);
                    }
                    document.body.removeChild(qrContainer);
                }, 200);
            };

            // Sayfa y√ºklendiƒüinde QR parametresini kontrol et
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const qrParam = urlParams.get('qr');
                
                if (qrParam) {
                    try {
                        const decoded = decodeURIComponent(escape(atob(qrParam)));
                        const params = new URLSearchParams(decoded);
                        
                        const productData = {
                            id: params.get('pid'),
                            name: params.get('pn'),
                            price: parseFloat(params.get('pp')),
                            category: params.get('pc')
                        };
                        
                        const salePrice = productData.price * 1.5;
                        setCustomerView({ show: true, product: productData, salePrice: salePrice });
                    } catch (e) {
                        console.error('QR decode hatasƒ±:', e);
                    }
                }
            }, []);

            // QR Modal a√ßƒ±ldƒ±ƒüƒ±nda QR kodu olu≈ütur
            useEffect(() => {
                if (qrModal.show && qrModal.product) {
                    setTimeout(() => {
                        const container = document.getElementById('qr-preview-container');
                        if (container) {
                            container.innerHTML = '';
                            new QRCode(container, {
                                text: generateQRUrl(qrModal.product),
                                width: 180, height: 180,
                                colorDark: '#000000', colorLight: '#ffffff',
                                correctLevel: QRCode.CorrectLevel.M
                            });
                        }
                    }, 100);
                }
            }, [qrModal]);

            // Kullanƒ±cƒ± oturumu kontrol√º
            useEffect(() => {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    try {
                        setCurrentUser(JSON.parse(savedUser));
                    } catch (error) {
                        localStorage.removeItem('currentUser');
                    }
                }
            }, []);

            // Firebase veri y√ºkleme
            useEffect(() => {
                const productsRef = database.ref('products');
                const settingsRef = database.ref('settings');
                const campaignsRef = database.ref('campaigns');

                const timeoutId = setTimeout(() => {
                    setLoadingError('Baƒülantƒ± √ßok yava≈ü. L√ºtfen sayfayƒ± yenileyin.');
                    setIsLoading(false);
                }, 5000);

                Promise.all([
                    productsRef.once('value').catch(() => null),
                    settingsRef.once('value').catch(() => null),
                    campaignsRef.once('value').catch(() => null)
                ]).then(([productsSnapshot, settingsSnapshot, campaignsSnapshot]) => {
                    clearTimeout(timeoutId);
                    
                    if (productsSnapshot?.val()) {
                        const data = productsSnapshot.val();
                        setProducts(Object.keys(data).map(key => ({ ...data[key], id: String(data[key].id || key) })));
                    } else {
                        const sampleProducts = {
                            '1': { id: '1', name: 'M8 Vida', unit: 'Adet', currentStock: 150, minStock: 50, priceTL: 2.50, priceUSD: 0.08, priceEUR: 0.07, category: 'Vida' },
                            '2': { id: '2', name: 'M10 Vida', unit: 'Adet', currentStock: 100, minStock: 50, priceTL: 3.50, priceUSD: 0.10, priceEUR: 0.09, category: 'Vida' },
                            '3': { id: '3', name: 'Pense', unit: 'Adet', currentStock: 25, minStock: 10, priceTL: 45.00, priceUSD: 1.30, priceEUR: 1.20, category: 'El Aletleri' }
                        };
                        productsRef.set(sampleProducts);
                        setProducts(Object.values(sampleProducts));
                    }

                    if (settingsSnapshot?.val()) {
                        setSettings(prev => ({ ...prev, ...settingsSnapshot.val() }));
                    }

                    if (campaignsSnapshot?.val()) {
                        setCampaigns(campaignsSnapshot.val());
                    }

                    setIsLoading(false);
                }).catch((error) => {
                    clearTimeout(timeoutId);
                    setLoadingError('Veri y√ºkleme hatasƒ±: ' + error.message);
                    setIsLoading(false);
                });
            }, []);

            const saveProducts = async (newProducts) => {
                try {
                    const productsObj = {};
                    newProducts.forEach(p => {
                        let safeId = String(p.id).replace(/[.#$\[\]\/]/g, '_');
                        productsObj[safeId] = { ...p, id: safeId };
                    });
                    await database.ref('products').set(productsObj);
                    setProducts(newProducts);
                    return true;
                } catch (error) {
                    alert('‚ùå Kayƒ±t hatasƒ±: ' + error.message);
                    return false;
                }
            };

            const saveSettings = async (updates) => {
                try {
                    await database.ref('settings').update(updates);
                    setSettings(prev => ({ ...prev, ...updates }));
                } catch (error) {
                    alert('‚ùå Kayƒ±t hatasƒ±!');
                }
            };

            const handleLogin = () => {
                const user = USERS[loginForm.username];
                if (user && user.password === loginForm.password) {
                    const userSession = { username: loginForm.username, ...user };
                    setCurrentUser(userSession);
                    localStorage.setItem('currentUser', JSON.stringify(userSession));
                    setLoginForm({ username: '', password: '' });
                } else {
                    alert('Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±!');
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                localStorage.removeItem('currentUser');
            };

            const isAdmin = currentUser?.role === 'admin';

            const categories = useMemo(() => {
                const unique = [...new Set(products.map(p => p.category).filter(Boolean))];
                return ['T√ºm√º', 'Kampanya', ...unique.sort()];
            }, [products]);

            const filteredProducts = useMemo(() => {
                let result = [...products];
                if (selectedCategory === 'Kampanya') {
                    result = result.filter(p => campaigns[p.id]);
                } else if (selectedCategory && selectedCategory !== 'T√ºm√º') {
                    result = result.filter(p => p.category === selectedCategory);
                }
                if (searchTerm?.trim()) {
                    const search = searchTerm.toLowerCase().trim();
                    result = result.filter(p => p.name.toLowerCase().includes(search) || (p.category || '').toLowerCase().includes(search));
                }
                return result;
            }, [products, selectedCategory, searchTerm, campaigns]);

            const paginatedProducts = useMemo(() => {
                const start = (currentPage - 1) * itemsPerPage;
                return filteredProducts.slice(start, start + itemsPerPage);
            }, [filteredProducts, currentPage, itemsPerPage]);

            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);

            useEffect(() => setCurrentPage(1), [selectedCategory, searchTerm]);

            const getDiscount = (cat) => settings.categoryDiscounts?.[cat] || settings.globalDiscount || 0;
            const calcPrice = (price, cat, productId) => campaigns[productId] ? campaigns[productId].price : (getDiscount(cat) > 0 ? price * (1 - getDiscount(cat) / 100) : price);
            const calcSalePrice = (base, profit) => base * (1 + profit / 100);

            const addToCart = (product, paymentType) => {
                const basePrice = calcPrice(product.priceTL, product.category, product.id);
                const finalPrice = calcSalePrice(basePrice, settings.profitRates[paymentType]);
                setCartForm({ productId: product.id, productName: product.name, price: finalPrice, quantity: 1, paymentType, manuelPrice: '' });
                setModals({ ...modals, addToCart: true });
            };

            const confirmAddToCart = () => {
                const hasManuel = cartForm.manuelPrice && Number(cartForm.manuelPrice) > 0;
                const finalPrice = hasManuel ? Number(cartForm.manuelPrice) : cartForm.price;
                setCart([...cart, {
                    id: Date.now(), productId: cartForm.productId, productName: cartForm.productName,
                    price: finalPrice, originalPrice: cartForm.price, quantity: Number(cartForm.quantity),
                    paymentType: cartForm.paymentType, total: finalPrice * Number(cartForm.quantity), isManuel: hasManuel
                }]);
                setModals({ ...modals, addToCart: false });
                setCartForm({ productId: null, productName: '', price: 0, quantity: 1, paymentType: 'pesin', manuelPrice: '' });
            };

            const removeFromCart = (id) => setCart(cart.filter(item => item.id !== id));
            const clearCart = () => confirm('Sepeti temizlemek istediƒüinizden emin misiniz?') && setCart([]);

            const cartTotal = useMemo(() => cart.reduce((sum, item) => sum + item.total, 0), [cart]);

            // Teklifler
            const loadOffers = async () => {
                try {
                    const snapshot = await database.ref('offers').once('value');
                    if (snapshot.val()) {
                        const data = Object.values(snapshot.val());
                        data.sort((a, b) => new Date(b.date) - new Date(a.date));
                        setOffers(data);
                    }
                } catch (e) { console.error(e); }
            };

            const loadOrders = async () => {
                try {
                    const snapshot = await database.ref('orders').once('value');
                    if (snapshot.val()) {
                        const data = Object.values(snapshot.val());
                        data.sort((a, b) => new Date(b.date) - new Date(a.date));
                        setOrders(data);
                    }
                } catch (e) { console.error(e); }
            };

            useEffect(() => { if (currentUser) { loadOffers(); loadOrders(); } }, [currentUser]);

            const createOffer = async () => {
                if (cart.length === 0) return alert('‚ö†Ô∏è Sepetiniz bo≈ü!');
                if (!offerForm.customerName.trim()) return alert('‚ö†Ô∏è M√º≈üteri adƒ± giriniz!');

                try {
                    const offer = {
                        id: 'TEK-' + Date.now(),
                        date: new Date().toISOString(),
                        user: currentUser.username,
                        userName: currentUser.name,
                        customerName: offerForm.customerName.trim(),
                        customerContact: offerForm.customerContact.trim(),
                        notes: offerForm.notes.trim(),
                        items: cart.map(item => ({ ...item, isManuel: item.isManuel || false })),
                        total: cartTotal,
                        status: 'Bekliyor'
                    };

                    await database.ref('offers/' + offer.id).set(offer);
                    alert(`‚úÖ Teklif olu≈üturuldu!\n\nTeklif No: ${offer.id}`);
                    setCart([]);
                    setOfferForm({ customerName: '', customerContact: '', notes: '' });
                    setModals({ ...modals, createOffer: false });
                    loadOffers();
                } catch (error) {
                    alert('‚ùå Hata: ' + error.message);
                }
            };

            const downloadCartAsPDF = () => {
                if (cart.length === 0) return alert('‚ö†Ô∏è Sepetiniz bo≈ü!');

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const formatNumber = (num) => num.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                
                const splitTextToLines = (text, maxWidth) => {
                    const asciiText = toAscii(text);
                    const words = asciiText.split(' ');
                    const lines = [];
                    let currentLine = '';
                    
                    words.forEach(word => {
                        const testLine = currentLine ? currentLine + ' ' + word : word;
                        if (doc.getTextWidth(testLine) > maxWidth && currentLine) {
                            lines.push(currentLine);
                            currentLine = word;
                        } else {
                            currentLine = testLine;
                        }
                    });
                    if (currentLine) lines.push(currentLine);
                    return lines.length > 0 ? lines : [asciiText];
                };
                
                doc.setFont("helvetica", "bold");
                doc.setFontSize(20);
                doc.text('SATIS TEKLIFI', 105, 20, { align: 'center' });
                
                doc.setFont("helvetica", "normal");
                doc.setFontSize(10);
                const tarih = new Date().toLocaleDateString('tr-TR');
                doc.text('Tarih: ' + tarih, 20, 35);
                
                doc.setFontSize(9);
                doc.text('AVANTAJ TEKNIK HIRDAVAT A.S.', 140, 35);
                doc.text('Tel: 0 537 266 8540', 155, 42);
                
                doc.line(15, 55, 195, 55);
                
                doc.setFontSize(9);
                doc.setFont("helvetica", "bold");
                let y = 65;
                doc.text('URUN ADI', 15, y);
                doc.text('ODEME', 105, y);
                doc.text('ADET', 130, y);
                doc.text('BIRIM', 150, y);
                doc.text('TOPLAM', 195, y, { align: 'right' });
                doc.line(15, y + 2, 195, y + 2);
                
                doc.setFont("helvetica", "normal");
                doc.setFontSize(8);
                y += 10;
                
                cart.forEach((item) => {
                    if (y > 255) { doc.addPage(); y = 20; }
                    
                    const nameLines = splitTextToLines(item.productName, 85);
                    doc.text(nameLines[0], 15, y);
                    
                    doc.text(item.paymentType === 'pesin' ? 'Pesin' : item.paymentType.replace('vade', '') + ' Gun', 105, y);
                    doc.text(item.quantity.toString(), 130, y);
                    doc.text(formatNumber(item.price), 150, y);
                    doc.text(formatNumber(item.total), 195, y, { align: 'right' });
                    
                    y += 5;
                    for (let i = 1; i < nameLines.length; i++) {
                        doc.text('  ' + nameLines[i], 15, y);
                        y += 4;
                    }
                    y += 2;
                });
                
                y += 5;
                doc.line(15, y, 195, y);
                y += 12;
                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.text('GENEL TOPLAM:', 130, y);
                doc.setFontSize(16);
                doc.text(formatNumber(cartTotal) + ' TL', 195, y, { align: 'right' });
                
                doc.save('teklif_' + tarih.replace(/\./g, '-') + '.pdf');
            };

            // Kampanya fonksiyonlarƒ±
            const saveCampaigns = async (newCampaigns) => {
                try {
                    await database.ref('campaigns').set(newCampaigns);
                    setCampaigns(newCampaigns);
                    return true;
                } catch (e) { return false; }
            };

            const openCampaignModal = () => {
                setTempData({ campaignProducts: { ...campaigns } });
                setModals({ ...modals, campaign: true });
            };

            // √úr√ºn ekleme/d√ºzenleme
            const handleAddProduct = async () => {
                if (!productForm.name.trim()) return alert('‚ùå √úr√ºn adƒ± bo≈ü olamaz!');
                
                const newProduct = {
                    id: Math.floor(Date.now()).toString(),
                    name: productForm.name.trim(),
                    category: productForm.category.trim() || 'Genel',
                    unit: productForm.unit,
                    priceTL: Number(productForm.priceTL) || 0,
                    priceUSD: Number(productForm.priceUSD) || 0,
                    priceEUR: Number(productForm.priceEUR) || 0,
                    currentStock: Number(productForm.currentStock) || 0,
                    minStock: Number(productForm.minStock) || 10
                };
                
                if (await saveProducts([...products, newProduct])) {
                    setModals({ ...modals, addProduct: false });
                    setProductForm({ name: '', category: '', unit: 'Adet', priceTL: 0, priceUSD: 0, priceEUR: 0, currentStock: 0, minStock: 10 });
                    alert('‚úÖ √úr√ºn eklendi!');
                }
            };

            const openEditProduct = (product) => {
                setTempData({ editingId: product.id });
                setProductForm({
                    name: product.name, category: product.category || '', unit: product.unit,
                    priceTL: product.priceTL || 0, priceUSD: product.priceUSD || 0, priceEUR: product.priceEUR || 0,
                    currentStock: product.currentStock, minStock: product.minStock
                });
                setModals({ ...modals, editProduct: true });
            };

            const handleEditProduct = async () => {
                const updated = products.map(p => p.id === tempData.editingId ? {
                    ...p, name: productForm.name.trim(), category: productForm.category.trim() || 'Genel',
                    unit: productForm.unit, priceTL: Number(productForm.priceTL) || 0,
                    priceUSD: Number(productForm.priceUSD) || 0, priceEUR: Number(productForm.priceEUR) || 0,
                    currentStock: Number(productForm.currentStock) || 0, minStock: Number(productForm.minStock) || 10
                } : p);
                
                if (await saveProducts(updated)) {
                    setModals({ ...modals, editProduct: false });
                    alert('‚úÖ G√ºncellendi!');
                }
            };

            const handleDeleteProduct = async (id) => {
                if (confirm('‚ö†Ô∏è Silmek istediƒüinizden emin misiniz?')) {
                    if (await saveProducts(products.filter(p => p.id !== id))) {
                        alert('‚úÖ Silindi!');
                    }
                }
            };

            // M√º≈üteri G√∂r√ºn√ºm√º (QR okutulduƒüunda)
            if (customerView.show && customerView.product) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
                            <div className="text-6xl mb-4">üè∑Ô∏è</div>
                            <h1 className="text-2xl font-bold text-gray-800 mb-2">{customerView.product.name}</h1>
                            <p className="text-gray-600 mb-4">{customerView.product.category}</p>
                            
                            <div className="bg-green-50 rounded-xl p-6 mb-6">
                                <p className="text-sm text-gray-600 mb-2">Satƒ±≈ü Fiyatƒ±</p>
                                <p className="text-5xl font-bold text-green-600">‚Ç∫{customerView.salePrice.toFixed(2)}</p>
                                <p className="text-sm text-gray-500 mt-2">KDV Dahil</p>
                            </div>
                            
                            <div className="text-sm text-gray-600 space-y-2">
                                <p>üìç AVANTAJ TEKNƒ∞K HIRDAVAT</p>
                                <p>üìû 0 537 266 8540</p>
                            </div>
                            
                            <button onClick={() => {
                                window.history.pushState({}, '', window.location.pathname);
                                setCustomerView({ show: false, product: null, salePrice: 0 });
                            }} className="mt-6 text-sm text-blue-500 hover:text-blue-700">
                                ‚Üê Ana Sayfaya D√∂n
                            </button>
                        </div>
                    </div>
                );
            }

            // Login Ekranƒ±
            if (!currentUser) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-md">
                            <div className="text-center mb-6">
                                <div className="text-5xl mb-4">üì¶</div>
                                <h1 className="text-2xl font-bold text-gray-800">Hƒ±rdavat Stok</h1>
                            </div>
                            <div className="space-y-3">
                                <input type="text" value={loginForm.username} onChange={(e) => setLoginForm({...loginForm, username: e.target.value})} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} className="w-full px-4 py-3 border rounded-lg" placeholder="Kullanƒ±cƒ± adƒ±" />
                                <input type="password" value={loginForm.password} onChange={(e) => setLoginForm({...loginForm, password: e.target.value})} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} className="w-full px-4 py-3 border rounded-lg" placeholder="≈ûifre" />
                                <button onClick={handleLogin} className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">Giri≈ü</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl animate-pulse mb-4">üì¶</div>
                            <p className="text-gray-600">Y√ºkleniyor...</p>
                        </div>
                    </div>
                );
            }

            if (loadingError) {
                return (
                    <div className="min-h-screen bg-red-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-lg p-6 text-center">
                            <div className="text-6xl mb-4">‚ùå</div>
                            <p className="text-red-600 mb-4">{loadingError}</p>
                            <button onClick={() => window.location.reload()} className="bg-blue-600 text-white px-6 py-2 rounded">Yenile</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 pb-20">
                    {/* Header */}
                    <div className="bg-blue-600 text-white p-4 shadow-lg">
                        <div className="flex justify-between items-center flex-wrap gap-2">
                            <div>
                                <h1 className="text-xl font-bold">üì¶ Hƒ±rdavat Stok</h1>
                                <p className="text-xs text-blue-100">{currentUser.name} | {filteredProducts.length} √ºr√ºn</p>
                            </div>
                            <div className="flex gap-1 flex-wrap">
                                {isAdmin && (
                                    <>
                                        <button onClick={() => setModals({...modals, addProduct: true})} className="bg-green-600 px-2 py-1.5 rounded text-xs">+ √úr√ºn</button>
                                        <button onClick={() => {setTempData({profit: settings.profitRates}); setModals({...modals, profit: true});}} className="bg-purple-500 px-2 py-1.5 rounded text-xs">Kar</button>
                                    </>
                                )}
                                <button onClick={() => setShowOffers(true)} className="bg-purple-600 px-2 py-1.5 rounded text-xs relative">
                                    üìã Teklifler
                                    {offers.filter(o => o.status === 'Bekliyor').length > 0 && <span className="absolute -top-1 -right-1 bg-orange-500 text-xs rounded-full w-4 h-4">{offers.filter(o => o.status === 'Bekliyor').length}</span>}
                                </button>
                                <button onClick={() => setShowCart(true)} className="bg-indigo-600 px-2 py-1.5 rounded text-xs relative">
                                    üõí
                                    {cart.length > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-4 h-4">{cart.length}</span>}
                                </button>
                                <button onClick={handleLogout} className="bg-red-500 px-2 py-1.5 rounded text-xs">√áƒ±kƒ±≈ü</button>
                            </div>
                        </div>
                    </div>

                    {/* Arama ve Kategoriler */}
                    <div className="p-3 space-y-3">
                        <input type="text" placeholder="üîç √úr√ºn ara..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full px-4 py-2 border rounded-lg" />
                        <div className="flex gap-2 overflow-x-auto pb-2">
                            {categories.map(cat => (
                                <button key={cat} onClick={() => setSelectedCategory(cat)} className={`px-3 py-1.5 rounded-lg whitespace-nowrap text-sm ${selectedCategory === cat ? 'bg-blue-600 text-white' : 'bg-white border'}`}>
                                    {cat}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* √úr√ºn Listesi */}
                    <div className="px-3 space-y-3">
                        {paginatedProducts.map((p) => {
                            const base = calcPrice(p.priceTL, p.category, p.id);
                            const isLowStock = p.currentStock <= p.minStock;
                            const isCampaign = campaigns[p.id];
                            
                            return (
                                <div key={p.id} className={`bg-white rounded-lg shadow p-3 ${isLowStock ? 'border-l-4 border-red-500' : ''} ${isCampaign ? 'border-2 border-pink-500' : ''}`}>
                                    <div className="flex justify-between mb-2">
                                        <div>
                                            <div className="flex items-center gap-2">
                                                <h3 className="font-semibold">{p.name}</h3>
                                                {isCampaign && <span className="bg-pink-500 text-white text-xs px-2 py-0.5 rounded-full">üéâ</span>}
                                            </div>
                                            <p className="text-xs text-gray-500">{p.category}</p>
                                        </div>
                                        <div className="flex gap-1">
                                            <button onClick={() => openQRModal(p)} className="px-2 py-1 bg-purple-50 text-purple-600 rounded text-xs hover:bg-purple-100" title="QR Kod & Etiket">üè∑Ô∏è</button>
                                            {isAdmin && (
                                                <>
                                                    <button onClick={() => openEditProduct(p)} className="px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs">‚úèÔ∏è</button>
                                                    <button onClick={() => handleDeleteProduct(p.id)} className="px-2 py-1 bg-red-50 text-red-600 rounded text-xs">üóëÔ∏è</button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="mb-2">
                                        <span className="font-bold text-blue-600">‚Ç∫{base.toFixed(2)}</span>
                                        <span className="text-xs text-gray-500 ml-2">Stok: {p.currentStock}</span>
                                    </div>
                                    
                                    <div className="grid grid-cols-4 gap-1 bg-green-50 p-2 rounded text-xs">
                                        <button onClick={() => addToCart(p, 'pesin')} className="hover:bg-green-100 p-1 rounded">
                                            <p className="text-gray-600">Pe≈üin</p>
                                            <p className="font-bold text-green-700">‚Ç∫{calcSalePrice(base, settings.profitRates.pesin).toFixed(2)}</p>
                                        </button>
                                        <button onClick={() => addToCart(p, 'vade30')} className="hover:bg-orange-100 p-1 rounded">
                                            <p className="text-gray-600">30G</p>
                                            <p className="font-bold text-orange-600">‚Ç∫{calcSalePrice(base, settings.profitRates.vade30).toFixed(2)}</p>
                                        </button>
                                        <button onClick={() => addToCart(p, 'vade60')} className="hover:bg-orange-100 p-1 rounded">
                                            <p className="text-gray-600">60G</p>
                                            <p className="font-bold text-orange-700">‚Ç∫{calcSalePrice(base, settings.profitRates.vade60).toFixed(2)}</p>
                                        </button>
                                        <button onClick={() => addToCart(p, 'vade90')} className="hover:bg-red-100 p-1 rounded">
                                            <p className="text-gray-600">90G</p>
                                            <p className="font-bold text-red-600">‚Ç∫{calcSalePrice(base, settings.profitRates.vade90).toFixed(2)}</p>
                                        </button>
                                    </div>
                                </div>
                            );
                        })}

                        {/* Sayfalama */}
                        {totalPages > 1 && (
                            <div className="flex justify-center gap-2 py-4">
                                <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="px-3 py-1 bg-blue-100 rounded disabled:opacity-50">¬´</button>
                                <span className="px-3 py-1 bg-blue-600 text-white rounded">{currentPage}/{totalPages}</span>
                                <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className="px-3 py-1 bg-blue-100 rounded disabled:opacity-50">¬ª</button>
                            </div>
                        )}
                    </div>

                    {/* QR Kod Modal */}
                    {qrModal.show && qrModal.product && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">üè∑Ô∏è QR Kod & Etiket</h2>
                                    <button onClick={closeQRModal} className="text-gray-500 text-2xl">‚úï</button>
                                </div>
                                
                                <div className="text-center mb-4">
                                    <p className="font-semibold text-lg">{qrModal.product.name}</p>
                                    <p className="text-sm text-gray-600">{qrModal.product.category}</p>
                                    <p className="text-2xl font-bold text-green-600 mt-2">
                                        ‚Ç∫{(qrModal.product.priceTL * 1.5).toFixed(2)}
                                        <span className="text-sm text-gray-500 ml-2">(%50 kar)</span>
                                    </p>
                                </div>
                                
                                <div id="qr-preview-container" className="flex justify-center mb-4 bg-gray-50 p-4 rounded"></div>
                                
                                <div className="space-y-2">
                                    <button onClick={() => printLabel(qrModal.product)} className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                                        üè∑Ô∏è Tek Etiket ƒ∞ndir (60x40mm)
                                    </button>
                                    
                                    <div className="flex gap-2">
                                        <input type="number" value={labelCount} onChange={(e) => setLabelCount(Number(e.target.value))} min="1" max="100" className="w-20 px-2 py-2 border rounded text-center" />
                                        <button onClick={() => printMultipleLabels(qrModal.product, labelCount)} className="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">
                                            üìÑ {labelCount} Etiket ƒ∞ndir (A4)
                                        </button>
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <button onClick={() => printMultipleLabels(qrModal.product, 21)} className="flex-1 bg-purple-600 text-white py-2 rounded hover:bg-purple-700 text-sm">
                                            21 Etiket (B√ºy√ºk)
                                        </button>
                                        <button onClick={() => printMultipleLabels(qrModal.product, 65)} className="flex-1 bg-pink-600 text-white py-2 rounded hover:bg-pink-700 text-sm">
                                            65 Etiket (K√º√ß√ºk)
                                        </button>
                                    </div>
                                </div>
                                
                                <p className="text-xs text-gray-500 text-center mt-4">
                                    QR kod okutulduƒüunda m√º≈üteri %50 kar eklenmi≈ü fiyatƒ± g√∂r√ºr
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Sepet Modal */}
                    {showCart && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">üõí Sepetim</h2>
                                    <button onClick={() => setShowCart(false)} className="text-gray-500">‚úï</button>
                                </div>
                                
                                {cart.length === 0 ? (
                                    <p className="text-center py-12 text-gray-500">Sepetiniz bo≈ü</p>
                                ) : (
                                    <>
                                        <div className="space-y-2 mb-4 max-h-64 overflow-y-auto">
                                            {cart.map(item => (
                                                <div key={item.id} className="border rounded p-2 flex justify-between items-center">
                                                    <div>
                                                        <p className="font-semibold text-sm">{item.productName}</p>
                                                        <p className="text-xs text-gray-600">{item.quantity} √ó ‚Ç∫{item.price.toFixed(2)}</p>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <p className="font-bold text-green-600">‚Ç∫{item.total.toFixed(2)}</p>
                                                        <button onClick={() => removeFromCart(item.id)} className="text-red-600">üóëÔ∏è</button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        
                                        <div className="border-t pt-4">
                                            <div className="flex justify-between items-center mb-4">
                                                <span className="font-semibold">Toplam:</span>
                                                <span className="text-2xl font-bold text-blue-600">‚Ç∫{cartTotal.toFixed(2)}</span>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={clearCart} className="flex-1 bg-red-500 text-white py-2 rounded">Temizle</button>
                                                <button onClick={downloadCartAsPDF} className="flex-1 bg-orange-500 text-white py-2 rounded">üìÑ PDF</button>
                                                <button onClick={() => {setShowCart(false); setModals({...modals, createOffer: true});}} className="flex-1 bg-purple-600 text-white py-2 rounded">üìã Teklif</button>
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Sepete Ekle Modal */}
                    {modals.addToCart && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full">
                                <h2 className="text-xl font-bold mb-4">üõí Sepete Ekle</h2>
                                <div className="space-y-3">
                                    <p className="font-semibold">{cartForm.productName}</p>
                                    <p className="text-green-600 font-bold">‚Ç∫{cartForm.price.toFixed(2)}</p>
                                    <div>
                                        <label className="block text-sm mb-1">Adet</label>
                                        <input type="number" min="1" value={cartForm.quantity} onChange={(e) => setCartForm({...cartForm, quantity: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    </div>
                                    <div>
                                        <label className="block text-sm mb-1">Manuel Fiyat (Opsiyonel)</label>
                                        <input type="number" step="0.01" placeholder="√ñzel fiyat..." value={cartForm.manuelPrice} onChange={(e) => setCartForm({...cartForm, manuelPrice: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded">
                                        <p className="text-2xl font-bold text-blue-600">
                                            ‚Ç∫{((cartForm.manuelPrice && Number(cartForm.manuelPrice) > 0 ? Number(cartForm.manuelPrice) : cartForm.price) * Number(cartForm.quantity)).toFixed(2)}
                                        </p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={confirmAddToCart} className="flex-1 bg-green-600 text-white py-2 rounded">Ekle</button>
                                        <button onClick={() => setModals({...modals, addToCart: false})} className="flex-1 bg-gray-300 py-2 rounded">ƒ∞ptal</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Teklif Olu≈ütur Modal */}
                    {modals.createOffer && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full">
                                <h2 className="text-xl font-bold mb-4">üìã Teklif Olu≈ütur</h2>
                                <div className="space-y-3">
                                    <input type="text" placeholder="M√º≈üteri Adƒ± *" value={offerForm.customerName} onChange={(e) => setOfferForm({...offerForm, customerName: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="text" placeholder="ƒ∞leti≈üim (Tel/Email)" value={offerForm.customerContact} onChange={(e) => setOfferForm({...offerForm, customerContact: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <textarea placeholder="Notlar..." value={offerForm.notes} onChange={(e) => setOfferForm({...offerForm, notes: e.target.value})} rows="2" className="w-full px-3 py-2 border rounded" />
                                    <div className="bg-gray-50 p-3 rounded">
                                        <p>√úr√ºn: {cart.length} | Toplam: <strong className="text-purple-600">‚Ç∫{cartTotal.toFixed(2)}</strong></p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={createOffer} className="flex-1 bg-purple-600 text-white py-2 rounded">Olu≈ütur</button>
                                        <button onClick={() => setModals({...modals, createOffer: false})} className="flex-1 bg-gray-300 py-2 rounded">ƒ∞ptal</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* √úr√ºn Ekle Modal */}
                    {modals.addProduct && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <h2 className="text-xl font-bold mb-4">Yeni √úr√ºn</h2>
                                <div className="space-y-3">
                                    <input type="text" placeholder="√úr√ºn Adƒ± *" value={productForm.name} onChange={(e) => setProductForm({...productForm, name: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="text" placeholder="Kategori" value={productForm.category} onChange={(e) => setProductForm({...productForm, category: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="number" step="0.01" placeholder="Fiyat TL" value={productForm.priceTL} onChange={(e) => setProductForm({...productForm, priceTL: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="number" placeholder="Stok" value={productForm.currentStock} onChange={(e) => setProductForm({...productForm, currentStock: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <div className="flex gap-2">
                                        <button onClick={handleAddProduct} className="flex-1 bg-green-600 text-white py-2 rounded">Ekle</button>
                                        <button onClick={() => setModals({...modals, addProduct: false})} className="flex-1 bg-gray-300 py-2 rounded">ƒ∞ptal</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* √úr√ºn D√ºzenle Modal */}
                    {modals.editProduct && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <h2 className="text-xl font-bold mb-4">√úr√ºn D√ºzenle</h2>
                                <div className="space-y-3">
                                    <input type="text" placeholder="√úr√ºn Adƒ±" value={productForm.name} onChange={(e) => setProductForm({...productForm, name: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="text" placeholder="Kategori" value={productForm.category} onChange={(e) => setProductForm({...productForm, category: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="number" step="0.01" placeholder="Fiyat TL" value={productForm.priceTL} onChange={(e) => setProductForm({...productForm, priceTL: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <input type="number" placeholder="Stok" value={productForm.currentStock} onChange={(e) => setProductForm({...productForm, currentStock: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                    <div className="flex gap-2">
                                        <button onClick={handleEditProduct} className="flex-1 bg-blue-600 text-white py-2 rounded">G√ºncelle</button>
                                        <button onClick={() => setModals({...modals, editProduct: false})} className="flex-1 bg-gray-300 py-2 rounded">ƒ∞ptal</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Kar Oranlarƒ± Modal */}
                    {modals.profit && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full">
                                <h2 className="text-xl font-bold mb-4">Kar Oranlarƒ± (%)</h2>
                                <div className="space-y-3">
                                    {['pesin', 'vade30', 'vade60', 'vade90'].map(key => (
                                        <div key={key}>
                                            <label className="block text-sm mb-1">{key === 'pesin' ? 'Pe≈üin' : key.replace('vade', '') + ' G√ºn'}</label>
                                            <input type="number" value={tempData.profit?.[key] || settings.profitRates[key]} onChange={(e) => setTempData({...tempData, profit: {...(tempData.profit || settings.profitRates), [key]: Number(e.target.value)}})} className="w-full px-3 py-2 border rounded" />
                                        </div>
                                    ))}
                                    <div className="flex gap-2">
                                        <button onClick={() => {saveSettings({profitRates: tempData.profit}); setModals({...modals, profit: false});}} className="flex-1 bg-purple-600 text-white py-2 rounded">Kaydet</button>
                                        <button onClick={() => setModals({...modals, profit: false})} className="flex-1 bg-gray-300 py-2 rounded">ƒ∞ptal</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Teklifler Modal */}
                    {showOffers && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">üìã Teklifler</h2>
                                    <button onClick={() => setShowOffers(false)} className="text-gray-500 text-2xl">‚úï</button>
                                </div>
                                
                                {offers.length === 0 ? (
                                    <p className="text-center py-12 text-gray-500">Hen√ºz teklif yok</p>
                                ) : (
                                    <div className="space-y-3">
                                        {offers.map(offer => (
                                            <div key={offer.id} className="border rounded-lg p-4">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div>
                                                        <span className="font-bold text-purple-600">{offer.id}</span>
                                                        <span className={`ml-2 px-2 py-0.5 rounded text-xs ${offer.status === 'Bekliyor' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}`}>{offer.status}</span>
                                                    </div>
                                                    <span className="text-xs text-gray-500">{new Date(offer.date).toLocaleDateString('tr-TR')}</span>
                                                </div>
                                                <p className="font-semibold">{offer.customerName}</p>
                                                <p className="text-sm text-gray-600">{offer.items.length} √ºr√ºn | <span className="font-bold text-purple-600">‚Ç∫{offer.total.toFixed(2)}</span></p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StokApp />);
    </script>
</body>
</html>
